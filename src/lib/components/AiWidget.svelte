<script lang="ts">
	let isOpen = $state(false);
	let messages = $state<{ role: 'user' | 'bot'; text: string }[]>([
		{ role: 'bot', text: '–ü—Ä–∏–≤–µ—Ç! –Ø –õ–∞–≤–∞–Ω–¥–∏–∫ üíú –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?' }
	]);
	let input = $state('');

	const quickQuestions = [
		'–ú–æ–∂–Ω–æ –±–µ–∑ –æ–ø—ã—Ç–∞?',
		'–ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ –≤ —Å—Ç–æ–∏–º–æ—Å—Ç—å?',
		'–ö–∞–∫ –Ω–∞–π—Ç–∏ —Å—Ç—É–¥–∏—é?',
		'–ú–æ–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ —Å —Ä–µ–±—ë–Ω–∫–æ–º?'
	];

	const answers: Record<string, string> = {
		'–ú–æ–∂–Ω–æ –±–µ–∑ –æ–ø—ã—Ç–∞?':
			'–ö–æ–Ω–µ—á–Ω–æ! –í—Å–µ –Ω–∞—à–∏ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã –Ω–∞ –ª—é–±–æ–π —É—Ä–æ–≤–µ–Ω—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏. –ú–∞—Å—Ç–µ—Ä –ø–æ–º–æ–∂–µ—Ç –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ.',
		'–ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ –≤ —Å—Ç–æ–∏–º–æ—Å—Ç—å?':
			'–í—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –Ω–∞–ø–∏—Ç–æ–∫ –∏ –≥–æ—Ç–æ–≤–æ–µ –∏–∑–¥–µ–ª–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã –∑–∞–±–µ—Ä—ë—Ç–µ —Å —Å–æ–±–æ–π.',
		'–ö–∞–∫ –Ω–∞–π—Ç–∏ —Å—Ç—É–¥–∏—é?':
			'–ê–¥—Ä–µ—Å —É–∫–∞–∑–∞–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏–≤–µ–Ω—Ç–∞. –ó–∞ –¥–µ–Ω—å –¥–æ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –º—ã –æ—Ç–ø—Ä–∞–≤–∏–º –≤–∞–º —Ç–æ—á–Ω—É—é –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é.',
		'–ú–æ–∂–Ω–æ –ø—Ä–∏–π—Ç–∏ —Å —Ä–µ–±—ë–Ω–∫–æ–º?':
			'–ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–≤–µ–Ω—Ç–∞. –£ –Ω–∞—Å –µ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –¥–µ—Ç—Å–∫–∏–µ –º–∞—Å—Ç–µ—Ä-–∫–ª–∞—Å—Å—ã. –ù–∞ –≤–∑—Ä–æ—Å–ª—ã–µ –∏–≤–µ–Ω—Ç—ã ‚Äî –æ—Ç 14 –ª–µ—Ç.'
	};

	function sendMessage(text: string) {
		if (!text.trim()) return;
		messages = [...messages, { role: 'user', text }];
		input = '';

		const answer = answers[text] || '–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–æ–ø—Ä–æ—Å! –ù–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è. –ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –≤ Instagram @libertybureau üíú';

		setTimeout(() => {
			messages = [...messages, { role: 'bot', text: answer }];
		}, 500);
	}
</script>

<!-- Floating button -->
<button
	class="fixed bottom-6 right-6 z-50 w-14 h-14 bg-brand text-white rounded-full shadow-lg hover:shadow-xl hover:scale-105 transition-all flex items-center justify-center text-2xl"
	onclick={() => (isOpen = !isOpen)}
	aria-label="–ß–∞—Ç —Å –õ–∞–≤–∞–Ω–¥–∏–∫–æ–º"
>
	{isOpen ? '‚úï' : 'üíú'}
</button>

<!-- Chat panel -->
{#if isOpen}
	<div class="fixed bottom-24 right-6 z-50 w-80 max-h-[28rem] bg-white rounded-2xl shadow-2xl border border-lavender-100 flex flex-col overflow-hidden">
		<!-- Header -->
		<div class="bg-brand text-white px-4 py-3">
			<p class="font-semibold text-sm">–õ–∞–≤–∞–Ω–¥–∏–∫ ‚Äî AI –ø–æ–º–æ—â–Ω–∏–∫</p>
			<p class="text-xs text-lavender-200">–°–ø—Ä–æ—Å–∏—Ç–µ —á—Ç–æ —É–≥–æ–¥–Ω–æ –æ –Ω–∞—à–∏—Ö –∏–≤–µ–Ω—Ç–∞—Ö</p>
		</div>

		<!-- Messages -->
		<div class="flex-1 overflow-y-auto p-4 space-y-3 min-h-0">
			{#each messages as msg}
				<div class="flex {msg.role === 'user' ? 'justify-end' : 'justify-start'}">
					<div
						class="max-w-[80%] px-3 py-2 rounded-2xl text-sm {msg.role === 'user'
							? 'bg-brand text-white rounded-br-md'
							: 'bg-lavender-100 text-lavender-900 rounded-bl-md'}"
					>
						{msg.text}
					</div>
				</div>
			{/each}
		</div>

		<!-- Quick questions -->
		{#if messages.length <= 2}
			<div class="px-4 pb-2 flex flex-wrap gap-1.5">
				{#each quickQuestions as q}
					<button
						class="text-xs px-3 py-1.5 bg-lavender-50 text-lavender-600 rounded-full hover:bg-lavender-100 transition-colors"
						onclick={() => sendMessage(q)}
					>
						{q}
					</button>
				{/each}
			</div>
		{/if}

		<!-- Input -->
		<div class="border-t border-lavender-100 p-3 flex gap-2">
			<input
				type="text"
				bind:value={input}
				placeholder="–í–∞—à –≤–æ–ø—Ä–æ—Å..."
				class="flex-1 px-3 py-2 border border-lavender-200 rounded-full text-sm focus:outline-none focus:border-brand"
				onkeydown={(e) => e.key === 'Enter' && sendMessage(input)}
			/>
			<button
				class="w-9 h-9 bg-brand text-white rounded-full flex items-center justify-center text-sm hover:bg-lavender-700 transition-colors"
				onclick={() => sendMessage(input)}
			>
				‚Üë
			</button>
		</div>
	</div>
{/if}
